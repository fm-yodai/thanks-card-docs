# デザインシステムガイド

「ありがとう」社内アプリのフロントエンド品質を長期的に維持するためのデザインシステム定義。「種まき」コンセプトを世界観の起点とする。

## 対象読者

- 本プロジェクトの開発メンバー
- コーディングエージェント（GitHub Copilot, Claude Code）

## レイヤー構造

デザインシステムは 4 層で構成される。下層ほど抽象的・汎用的で、上層ほどプロジェクト固有になる。

```
L4  パターン・ガイドライン   使い方の「約束」
L3  ドメインコンポーネント   プロジェクト固有の UI 部品
L2  基盤コンポーネント       汎用 UI 部品
L1  デザイントークン         すべての土台となる「値」
```

AI コード生成の一貫性は L1 の整備度に最も依存する。

## 基本原則

1. **トークン準拠** — すべての色・余白・フォントサイズ等は CSS 変数（トークン）で指定する。ハードコード値は原則禁止。
2. **コンポーネント再利用** — 既存の基盤コンポーネントがあれば新規作成しない。
3. **命名の統一** — コンポーネント、トークン、Pencil レイヤーの命名規約を守る。
4. **Grid ベースのレスポンシブ** — CSS Grid を主軸に、コンテナクエリは最小限で補完。メディアクエリは使用しない。
5. **Single Source of Truth** — トークンの正は `src/styles/tokens.css`。コンポーネントの正は `src/components/`。`.pen` ファイルはそれらの視覚的表現であり、食い違いが生じた場合はコード側を正とする。

---

## プロダクトコンセプト

デザインシステムのすべての判断の起点となるプロダクトの世界観を定義する。

### コンセプト

> 忙しさの中で忘れかけた温もりを、そっと思い出させてくれるもの。

### 種まき

> 今日の「ありがとう」は 明日の土壌になる。

日々の「助かった」を言葉にする。ただそれだけのことが、気づけば組織の根を静かに強くしていく。

| メタファー | 意味 |
|---|---|
| 手のひらから届く | 感謝は大げさなものではない。日常の延長で、気軽に、自然に送れる |
| 習慣が根を張る | 一回きりのイベントではなく、繰り返すことで文化になる |
| 空気が変わる | 個人の行動が積み重なり、組織全体の雰囲気をじわりと変えていく |

### デザインへの翻訳

このコンセプトがデザイン判断にどう影響するかの指針。

#### トーン

- **そっと、静かに。** 派手な演出や過度な装飾ではなく、落ち着いた温かさを基調とする。
- **押しつけない。** ユーザーに行動を強制する UI（しつこい通知、煽る文言）は避ける。自然と手が伸びる設計を目指す。
- **誠実に。** 飾りすぎない。伝えるべきことを、まっすぐに伝える。

#### ビジュアルの方向性

- 色調は温かみのあるトーンを基本とする。具体的な色値は[デザイントークン](#デザイントークン)で定義する。
- 余白を十分にとる。情報を詰め込みすぎず、呼吸のあるレイアウトを心がける。
- アニメーションは控えめに。「種が芽吹く」ような静かな動きが似合う。速すぎず、遅すぎず。

#### やること・やらないこと

| やること | やらないこと |
|---|---|
| 感謝を送る行為のハードルを下げる | 派手な通知やポップアップで驚かせる |
| 受け取った人がそっと嬉しくなる見せ方 | 使うたびに存在を主張する UI |
| 日常に溶け込む控えめな UI | 即時的な報酬感・射幸心を煽る仕掛け |
| 静かに積み重なっていく感覚の演出 | 送信数のランキングなど、他者との競争を促す仕組み |
| 個人の中に「送ってみようかな」と思わせる仕掛け | — |

#### ゲーミフィケーションについて

他者との競争を煽る仕組みは設けない。ただし、個人の内発的な動機を静かに後押しするゲーミフィケーションは積極的に取り入れる。

コンセプトに沿うゲーミフィケーションの方向性:

- **種が育つ感覚。** 自分が送った「ありがとう」の積み重なりが、静かに可視化される（例: 畑に種が増えていくような表現）
- **習慣のリズム。** 連続して送っていることがさりげなく伝わる。ただしストリークが途切れたことを責めない
- **自分だけの振り返り。** 自分がどんなコンピテンシーの感謝を多く送っているか等、内省につながるフィードバック

避けるべき方向性:

- 送信数の他者比較・ランキング
- 未送信を煽るプッシュ通知
- ポイントや報酬による外発的動機づけ

---

## デザイントークン

デザインの最小単位。色・余白・フォント・角丸・影・モーションなどの値を CSS 変数として一元定義する。すべてのコンポーネントはこのトークンのみを参照する。

### 命名規則

```
--ds-{カテゴリ}-{名前}
```

例: `--ds-color-primary-500`, `--ds-space-4`, `--ds-font-size-base`

### Color

「種まき」コンセプトに基づき、温かみのあるトーンを基調とする。

#### 構造

色トークンは Primitive（実値）と Semantic（用途名）の 2 層で管理する。コンポーネントでは Semantic カラーを使用する。

```
Primitive（実値）           Semantic（用途名）
──────────────────        ──────────────────
--ds-color-primary-500  ←  --ds-color-interactive-default
--ds-color-neutral-900  ←  --ds-color-text-primary
--ds-color-neutral-50   ←  --ds-color-surface-base
```

この分離により、将来のダークモード対応は Semantic 層の参照先を切り替えるだけで済む。

#### Primitive カラー

| グループ | スケール | 用途 |
|---|---|---|
| `primary` | 50 〜 900（10 段階） | メインカラー |
| `neutral` | 50 〜 900（10 段階） | グレースケール |

#### Semantic カラー

| カテゴリ | トークン例 | 用途 |
|---|---|---|
| テキスト | `text-primary`, `text-secondary`, `text-tertiary`, `text-inverse` | 文字色 |
| サーフェス | `surface-base`, `surface-card`, `surface-overlay` | 背景色 |
| ボーダー | `border-default`, `border-strong` | 境界線 |
| インタラクティブ | `interactive-default`, `interactive-hover`, `interactive-active`, `interactive-disabled` | ボタン・リンク等 |
| ステータス | `success`, `warning`, `error`, `info` | フィードバック |

#### コンピテンシーカラー

5 つのコアコンピテンシーにそれぞれ固有の色を割り当てる。通常版と背景用の薄い版（`-subtle`）を用意する。

| ID | 名称 | トークン |
|---|---|---|
| `sincerity` | 誠実 | `--ds-color-competency-sincerity` |
| `ownership` | 当事者意識 | `--ds-color-competency-ownership` |
| `collaboration` | 協働 | `--ds-color-competency-collaboration` |
| `challenge` | 挑戦への意欲 | `--ds-color-competency-challenge` |
| `creativity` | 創造的思考 | `--ds-color-competency-creativity` |

各コンピテンシーにはピクトグラム画像を用意している（`design/brand-kit.pen` および画像アセットとして管理）。Emoji は使用しない。

### Spacing

4px 刻みの 8 段階。余白・パディング・ギャップにはこのスケールのみを使用する。

| トークン | 値 | 用途の目安 |
|---|---|---|
| `space-1` | 4px | アイコンとテキストの間など最小の間隔 |
| `space-2` | 8px | コンパクトな要素内のパディング |
| `space-3` | 12px | 関連する要素間の余白 |
| `space-4` | 16px | カード内パディング、標準的な余白 |
| `space-5` | 24px | セクション内の要素間 |
| `space-6` | 32px | セクション間の余白 |
| `space-7` | 48px | ページレベルの大きな余白 |
| `space-8` | 64px | ヒーローセクション等の特大余白 |

### Typography

| カテゴリ | トークン | 備考 |
|---|---|---|
| ファミリー | `font-family-display`, `font-family-body`, `font-family-mono` | 日本語対応フォントを選定する |
| サイズ | `font-size-xs`(12) 〜 `font-size-3xl`(30) の 7 段階 | |
| ウェイト | `font-weight-regular`(400), `medium`(500), `semibold`(600), `bold`(700) | |
| 行間 | `line-height-tight`(1.25), `normal`(1.5), `relaxed`(1.75) | 日本語本文には `relaxed` を推奨 |

### Shape

| カテゴリ | トークン | 備考 |
|---|---|---|
| 角丸 | `radius-none`(0), `sm`(4), `md`(8), `lg`(12), `xl`(16), `full`(9999) | Avatar 等の円形要素には `full` |
| 影 | `shadow-sm`, `shadow-md`, `shadow-lg` | |
| 罫線幅 | `border-thin`(1px), `border-medium`(2px) | |

### Motion

アニメーションは控えめに。「種が芽吹く」ような静かな動きを基調とする。

| カテゴリ | トークン | 用途の目安 |
|---|---|---|
| 持続時間 | `duration-fast`(150ms), `duration-normal`(250ms), `duration-slow`(400ms) | |
| イージング | `easing-default`(ease-out), `easing-in-out`, `easing-spring` | カード送信演出等には `spring` |

### レスポンシブ設計

#### 基本方針

メディアクエリではなく **CSS Grid + コンテナクエリ** で対応する。

- `display: grid` と `auto-fill` / `auto-fit` を活用し、明示的なブレイクポイント分岐なしでコンテンツを流し込む設計を基本とする。
- Grid だけでは対応できないレイアウト変化（例: サイドバーの表示切替）に限り、コンテナクエリを使用する。コンテナクエリの使用は最小限に抑える。
- メディアクエリは使用しない。

#### 設計の優先順位

```
1. CSS Grid（auto-fill / minmax 等）で暗黙的にレスポンシブにする ← 最優先
2. Grid だけでは不足する場合にコンテナクエリで補う ← 限定的に使用
3. メディアクエリ ← 使用しない
```

#### コンテナクエリのサイズ目安

コンテナクエリを使う場合の参考値。ビューポートではなくコンテナ幅に対する閾値。

| 目安 | 用途 |
|---|---|
| < 400px | コンパクト表示（カードの縦積み等） |
| 400px 〜 640px | 標準表示 |
| > 640px | 拡張表示（横並びレイアウト等） |

これらは目安であり、コンテナの文脈に応じて適切な値を判断すること。

---

## コンポーネント体系

コンポーネントは 2 つのレイヤーに分かれる。

- **L2 基盤コンポーネント**（`src/components/ui/`）— プロジェクト非依存の汎用 UI 部品
- **L3 ドメインコンポーネント**（`src/components/domain/`）— 本アプリ固有の UI 部品

L3 は L2 の組み合わせで構築する。

### L2 基盤コンポーネント

配置先: `src/components/ui/`

| 分類 | コンポーネント | 備考 |
|---|---|---|
| **操作** | Button | Variant: primary / secondary / ghost / danger。Size: sm / md / lg |
| | Input | テキスト入力。バリデーション状態の視覚表現を含む |
| | Textarea | 複数行テキスト入力 |
| **表示** | Badge | 汎用ラベル |
| | Tag | 取り外し可能なタグ |
| | Avatar | ユーザーアイコン。イニシャルフォールバック付き |
| | Icon | アイコンセットのラッパー |
| **レイアウト** | Stack | Flexbox ベースの汎用配置（垂直・水平） |
| | Container | 最大幅制約 + 中央寄せ |
| | Grid | レスポンシブグリッド |
| | Divider | 区切り線 |
| **フィードバック** | Toast | 操作完了・エラー通知 |
| | Skeleton | 読込中の仮表示 |
| | EmptyState | データなし時の案内表示 |
| | Modal | 確認ダイアログ等 |
| | Spinner | インライン読込表示 |
| **ナビゲーション** | Header | アプリ上部バー |
| | Tab | タブ切替 |
| | Sidebar | サイドナビゲーション |

各コンポーネントはデザイントークンのみを参照し、ハードコード値を含まない。

### L3 ドメインコンポーネント

配置先: `src/components/domain/`

このプロジェクトのビジネスドメインに固有の UI 部品。

#### カード関連

| コンポーネント | 役割 |
|---|---|
| ThankYouCard | 感謝カード本体の表示。送信者・受信者・メッセージ・コンピテンシータグを含む |
| CardComposer | カード作成フォーム。宛先選択 + メッセージ入力 + AI ラベルプレビュー |
| CompetencyBadge | コンピテンシーの表示。対応するピクトグラム・色・ラベルを表示する。色は `--ds-color-competency-*` トークンを使用し、アイコンはプロジェクトで用意したピクトグラム画像を使用する |

#### タイムライン関連

| コンポーネント | 役割 |
|---|---|
| CardTimeline | 感謝カードのフィード表示 |
| TimelineFilter | 期間・部署・コンピテンシーでの絞り込み |

#### 分析関連

| コンポーネント | 役割 |
|---|---|
| CompetencyRadarChart | コンピテンシー分布のレーダーチャート |
| DepartmentHeatmap | 部署間の交流量ヒートマップ |
| MonthlyReportCard | 月次サマリー表示 |

#### ユーザー関連

| コンポーネント | 役割 |
|---|---|
| MemberPicker | 送信先の社員を検索・選択する UI |
| ProfileSummary | 受け取ったカード数やコンピテンシー傾向の表示 |

### 配置先の判断基準

| 質問 | はい | いいえ |
|---|---|---|
| 他プロジェクトでも使えるか？ | `ui/`（L2） | 次へ |
| 2 箇所以上で使われるか？ | `domain/`（L3） | ページ内にインラインで定義 |
| ビジネスロジックを含むか？ | `domain/`（L3） | `ui/`（L2） |

### コンポーネント命名規約

| 対象 | 規約 | 例 |
|---|---|---|
| コンポーネント名 | PascalCase | `ThankYouCard`, `CompetencyBadge` |
| コンポーネントファイル名 | コンポーネント名と一致 | `ThankYouCard.{ext}` |
| ディレクトリ | kebab-case | `ui/`, `domain/` |

---

## パターン・ガイドライン

コンポーネントの使い方・レイアウトの組み合わせ方・文言のトーンを規定するルール。チーム全員と AI が同じ判断をするための「約束」。

> 本セクションはデザインシステムの **原則** を定める。各画面の具体的なフローや仕様は、要件定義・スプリントプランニングの中で別途確定する。

### レイアウト

#### ページ構成

すべてのページは「Header（固定）→ Main Content → Footer（任意）」の構成を基本とする。

コンテンツエリアのバリエーション:

| パターン | 適するケース |
|---|---|
| シングルカラム | フォーム、詳細表示など焦点を絞る画面 |
| サイドバー付き | フィルタリングを伴う一覧画面 |
| グリッド | カードなど同型要素の繰り返し表示 |

#### レスポンシブ方針

モバイルファースト。PC ブラウザがメインだが、スマートフォン閲覧も想定する。

CSS Grid（`auto-fill` / `minmax` 等）を活用し、明示的なブレイクポイント分岐なしでレスポンシブにする設計を基本とする。Grid だけでは対応できないレイアウト変化に限り、コンテナクエリで補う。メディアクエリは使用しない。詳細は[レスポンシブ設計](#レスポンシブ設計)を参照。

### インタラクションの原則

個別の画面フローではなく、アプリ全体で一貫させるべき振る舞いのルール。

#### 状態表現

すべてのユーザー操作に対して、以下の状態を適切に表現すること。

| 状態 | 原則 |
|---|---|
| 待機中 | 操作可能であることが視覚的に明確 |
| 処理中 | Spinner 等で処理中であることを伝える。トリガーとなった操作は無効化し、二重実行を防ぐ |
| 完了 | Toast 等で結果をフィードバックする |
| エラー | 何が起きたか・どうすればよいかを伝える。ユーザーの入力は保持する（消さない） |
| データなし | EmptyState で次のアクションを案内する |

#### ローディング

| 原則 | 説明 |
|---|---|
| 形状を予約する | ページ初回読込時は Skeleton でコンテンツの形状を仮表示し、レイアウトシフトを防ぐ |
| チラつきを防ぐ | 体感 0.3 秒未満の処理ではローディング表示を出さない |
| 位置を近くする | 処理中表示は、トリガーとなった操作の近くに配置する |

#### エラー表示

| 原則 | 説明 |
|---|---|
| 解決策を先に伝える | 「何が起きたか」より「どうすればよいか」を優先して表示する |
| 表示位置を使い分ける | バリデーションエラーはフィールド直下にインライン表示。通信エラー等はグローバルな Toast |
| ユーザーの入力を消さない | エラー発生時、フォームの入力内容は保持する |

#### モーダル

- 確認が必要な操作にのみ使う。情報表示だけならページ遷移やインライン展開を優先する。
- ネストしない。背景スクロールを無効化する。

### 文言・トーンガイド

[プロダクトコンセプト](#プロダクトコンセプト)の世界観に基づく。

#### 基本トーン

温かく、簡潔で、肯定的。カジュアルすぎず堅すぎない丁寧語。「そっと思い出させてくれる」存在として、押しつけがましさを排し、静かな温かさを基調とする。

#### 書き方の原則

| 要素 | ルール |
|---|---|
| ボタン | 動詞で始める |
| 見出し | 名詞 or 体言止め |
| 説明文 | 1〜2 文で端的に |
| プレースホルダー | 入力例を示す |
| エラーメッセージ | 解決策を先に。否定表現を避ける |
| 空状態 | メッセージ + 次のアクションへの案内をセットで |

### 命名規約

| 対象 | 規約 | 例 |
|---|---|---|
| コンポーネント名 | PascalCase | `ThankYouCard` |
| CSS 変数 | `--ds-{category}-{name}` | `--ds-color-primary-500` |
| Pencil レイヤー名 | kebab-case | `thank-you-card-container` |
| 定数 | UPPER_SNAKE_CASE | `COMPETENCY_MAP` |
| ディレクトリ | kebab-case | `ui/`, `domain/` |

Pencil レイヤーの命名は AI がクラス名やコンポーネント構造を推測する材料になるため、特に重要。`Frame 42` のような自動命名は必ず書き換える。

---

## Pencil MCP 連携

Pencil MCP を使ったデザインとコードの双方向ワークフローを定義する。

### 前提

- デザインファイル: `.pen` 形式（JSON ベース、Git 管理）
- AI エージェントは MCP 経由で `.pen` のベクターデータを読み取り、コードを生成する
- `.pen` はデザインの「視覚的表現」であり、正（Single Source of Truth）はコード側

### ワークフロー

```
  .pen ファイル ──── MCP (read) ────→ AI エージェント
       ↑                                    │
       │            tokens.css              │
       │            components/    ← 参照 ──┘
       │                                    │
       └──────── MCP (write) ←──────────────┘
```

1. Pencil でデザインを作成・編集する
2. AI エージェントに指示する
3. AI が MCP 経由で `.pen` を読み取る
4. 既存トークン・コンポーネントを参照してコードを生成する
5. 必要に応じて AI が `.pen` 側を更新する（双方向）

### デザインファイル構成

```
design/
├── design-tokens.pen      トークンの視覚カタログ
├── components.pen         基盤コンポーネント一覧（全 Variant × Size）
├── screens/
│   ├── home.pen
│   ├── card-compose.pen
│   ├── timeline.pen
│   └── analytics.pen
└── brand-kit.pen          ロゴ・アイコン等
```

#### `.pen` ファイル作成ルール

1. トークンで定義した値を使う。カラーピッカーで任意の色を使わない。
2. レイヤー名をセマンティックに命名する（kebab-case）。自動命名のまま放置しない。
3. 共通化すべき要素は Pencil 上でもコンポーネント化する。
4. モバイル（375px）とデスクトップ（1280px）の 2 パターンを用意する。

### プロンプト設計の原則

AI への指示で一貫して伝えるべきことを以下に定める。具体的なプロンプト文は、採用するフレームワーク・エージェントに応じてチームで整備する。

#### 常に含めるべき制約

- `tokens.css` のトークンを使うこと（ハードコード禁止）
- 既存コンポーネントを確認し再利用すること
- レスポンシブは CSS Grid ベースで実装し、コンテナクエリの使用は最小限に留めよ。メディアクエリは使用しない。
- Pencil レイヤー名を参考にセマンティックな命名をすること

#### 目的別の指示パターン

| 目的 | AI に伝えること |
|---|---|
| 画面のコード生成 | 対象の `.pen` ファイルパス + 上記の制約 |
| 単一コンポーネント生成 | `components.pen` 内の対象レイヤー名 + Variant/Size の網羅 |
| デザインの更新（コード→デザイン） | 変更されたコードファイル + 反映すべき変更内容 |
| トークン乖離チェック | `.pen` ファイル群をスキャンし、トークン外の値を一覧化 |

### AI ルールファイル

各エージェントのルールファイルにデザインシステムの制約を記載し、エージェントが自動的に読み込むようにする。

| エージェント | ルールファイル |
|---|---|
| Claude Code | `CLAUDE.md`（プロジェクトルート） |
| GitHub Copilot | `.github/copilot-instructions.md` |

記載すべき項目:

- プロダクトコンセプトへの参照
- トークン使用の義務（ハードコード禁止）
- 既存コンポーネントの確認・再利用ルール
- 命名規約
- Pencil 連携ルール（トークン外の値の丸め方、乖離の報告）
- レスポンシブ方針（CSS Grid ベース、コンテナクエリは最小限、メディアクエリ不使用）
- アクセシビリティの基本要件
- デザインシステムドキュメントの参照先パス

### 将来の移行パス

Pencil はまだ新しいツールであり、他ツールへの移行が必要になる可能性がある。以下の設計判断で移行コストを最小化している。

| 設計判断 | 移行を容易にする理由 |
|---|---|
| トークンは CSS 変数で管理 | ツール非依存。Figma Variables / Style Dictionary 等に変換可能 |
| コンポーネントはフレームワークのコードで実装 | デザインツールに依存しない |
| `.pen` は「視覚表現」であり「正」ではない | `.pen` を破棄してもコードに影響なし |
| 命名規約が統一されている | 別ツールでも同じ命名で再構築可能 |

保険として、トークンを DTCG（Design Tokens Community Group）形式の JSON でも管理しておくと、将来の変換が容易になる。

---

## 保守・運用ルール

デザインシステムはプロダクトとともに育てる生きたシステムである。AI 生成コードを多用する開発では、品質のドリフト（逸脱）を防ぐ仕組みが特に重要になる。

### Git 管理

#### ブランチ命名

| 変更内容 | ブランチ命名 | 理由 |
|---|---|---|
| トークン変更 | `ds/token-{内容}` | 影響範囲が大きいため分離 |
| 基盤コンポーネント変更 | `ds/component-{名前}` | |
| ドメインコンポーネント変更 | `feature/{機能名}` | 通常の機能ブランチに含める |
| `.pen` ファイルのみの変更 | `ds/design-{画面名}` | |

#### PR ルール

- `.pen` ファイルの変更を含む PR にはスクリーンショットを添付する。
- `tokens.css` の変更を含む PR には影響を受けるコンポーネント・画面の一覧を本文に記載する。
- 基盤コンポーネント（L2）の追加時は[コンポーネント体系](#コンポーネント体系)の更新をセットで行う。

#### コードレビューの DS チェックポイント

```
□ ハードコードされた色値が含まれていないか
□ トークンに定義されていない余白値が使われていないか
□ 既存コンポーネントで代替できるのに新規作成していないか
□ 命名規約に従っているか
□ Pencil レイヤー名がセマンティックか（自動命名のまま残っていないか）
□ レスポンシブが CSS Grid ベースになっているか（不要なコンテナクエリやメディアクエリがないか）
```

### スプリント棚卸し

2 週間スプリントの振り返りで DS 健全性チェックを実施する（10〜15 分）。

#### チェックリスト

```
□ ハードコード値が新規コードに混入していないか
□ 新しく作った共通パーツが components/ui/ に切り出されているか
□ .pen ファイルが最新のコードと同期しているか
□ AI ルールファイルに追記すべきルールがないか
□ 未使用のトークンやコンポーネントがないか
□ AI 生成コードの品質傾向に変化はないか
```

#### 判断基準

| 発見事項 | アクション |
|---|---|
| あるパターンが 2 箇所以上で使われている | L2 or L3 コンポーネントへの昇格を検討 |
| トークンにない値がハードコードされている | トークン追加 or 既存トークンへの丸め |
| 1 箇所でしか使われないコンポーネント | ページ内インライン定義のまま。components/ に入れない |
| 使われなくなったトークン / コンポーネント | 影響範囲を確認の上、削除を検討 |

### AI 精度の改善サイクル

#### 評価

AI 生成コードを 3 段階で評価し、スプリントごとに傾向を記録する。

| 評価 | 定義 | 目標割合 |
|---|---|---|
| A | そのまま使える | 60% 以上 |
| B | 微調整で使える | 30% 以下 |
| C | 書き直しが必要 | 10% 以下 |

#### 改善アクション

| AI の問題パターン | 対処 |
|---|---|
| 特定の値をハードコードしがち | AI ルールファイルに禁止ルールを追記 |
| 既存コンポーネントを使わず新規作成する | ルールファイルにコンポーネント一覧を追記 |
| 命名が規約に合わない | 具体例をルールファイルに追記 |
| レスポンシブが不十分 | Grid ベースの設計とコンテナクエリの使い方をルールファイルに追記 |

AI ルールファイルの品質が以後すべての AI 生成コードの品質を決定するため、改善サイクルの中で最も重要な成果物として扱う。

### トークン・コンポーネントの変更手順

#### トークン追加

1. `tokens.css` に CSS 変数を追加
2. [デザイントークン](#デザイントークン)の定義を追記
3. `design-tokens.pen` を更新
4. PR でレビュー

#### トークン変更

1. 影響を受けるコンポーネント・画面を検索で洗い出す
2. `ds/token-*` ブランチで変更
3. 影響箇所の見た目を確認
4. ドキュメントと `.pen` を更新
5. PR にスクリーンショット（変更前後）を添付

#### トークン削除

1. 使用箇所がゼロであることを確認
2. 使用箇所がある場合は代替トークンへの移行を先に実施
3. `tokens.css`・ドキュメント・`.pen` から削除

#### 基盤コンポーネント（L2）の変更

破壊的変更がある場合はチームに事前共有する。使用箇所を洗い出し、すべての画面で見た目が崩れないことを確認する。[コンポーネント体系](#コンポーネント体系)と `components.pen` の更新を忘れないこと。

### スケール戦略

#### ダークモード（将来）

Semantic カラーと Primitive カラーを分離しているため、Semantic 層の参照先を切り替えるだけで対応可能。コンポーネント側の変更は不要。

#### 多言語対応（将来）

UI 文言をコンポーネントにハードコードせず、外部から渡す設計にしておくと i18n 対応が容易になる。

#### Pencil からの移行（将来）

`tokens.css` とコンポーネントコードはツール非依存のため、`.pen` を破棄してもプロダクトに影響しない。DTCG 形式の JSON でもトークンを管理しておくと、Style Dictionary 等への変換がスムーズになる。
